--- FILE: execute.py ---
import json

import pandas as pd


def main():
    # Read the data from CSV
    df = pd.read_csv("data.csv")

    # Compute revenue
    df["revenue"] = df["units"] * df["price"]

    # row_count
    row_count = len(df)

    # regions: count of distinct regions
    regions_count = df["region"].nunique()

    # top_n_products_by_revenue (n=3)
    n = 3
    top_products = (
        df.groupby("product")["revenue"]
        .sum()
        .sort_values(ascending=False)
        .head(n)
        .reset_index()
    )
    top_products_list = [
        {"product": row["product"], "revenue": float(row["revenue"])}
        for _, row in top_products.iterrows()
    ]

    # rolling_7d_revenue_by_region: for each region, last value of 7-day moving average of daily revenue
    df["date"] = pd.to_datetime(df["date"])  # ensure datetime
    daily_rev = (
        df.groupby(["region", "date"])["revenue"]  # daily revenue per region (FIXED TYPO)
        .sum()
        .reset_index()
        .sort_values(["region", "date"])  # ensure sorted for rolling
    )

    # Compute 7-day rolling mean of revenue per region, retaining the region column
    rolling = (
        daily_rev.groupby("region")
        .apply(lambda g: g.set_index("date")["revenue"].rolling("7D").mean(), include_groups=False)
        .reset_index(name="rolling_7d_revenue")
    )

    last_rolling = (
        rolling.sort_values(["region", "date"])  # ensure order
        .groupby("region")
        .tail(1)
    )

    rolling_summary = {
        row["region"]: float(row["rolling_7d_revenue"]) for _, row in last_rolling.iterrows()
    }

    result = {
        "row_count": int(row_count),
        "regions": int(regions_count),
        "top_n_products_by_revenue": top_products_list,
        "rolling_7d_revenue_by_region": rolling_summary,
    }

    print(json.dumps(result, indent=2))


if __name__ == "__main__":
    main()
--- FILE: data.csv ---
date,region,product,units,price
2023-01-01,East,Laptop,10,1200.0
2023-01-01,West,Mouse,50,25.0
2023-01-02,East,Laptop,15,1200.0
2023-01-02,Central,Keyboard,30,75.0
2023-01-03,West,Mouse,40,25.0
2023-01-03,East,Monitor,5,300.0
2023-01-04,East,Laptop,20,1200.0
2023-01-04,West,Mouse,60,25.0
2023-01-05,Central,Keyboard,25,75.0
2023-01-05,East,Monitor,8,300.0
2023-01-06,West,Mouse,35,25.0
2023-01-06,East,Laptop,18,1200.0
2023-01-07,Central,Keyboard,20,75.0
2023-01-07,East,Monitor,10,300.0
2023-01-08,West,Mouse,45,25.0
2023-01-08,East,Laptop,22,1200.0
--- FILE: .github/workflows/ci.yml ---
name: CI/CD Pipeline

on:
  push:
    branches:
      - main # or master, depending on your default branch name

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas ruff

      - name: Run Ruff checks
        run: ruff check .

      - name: Execute Python script and generate result.json
        run: python execute.py > result.json

      - name: Upload result.json for GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: result.json

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4